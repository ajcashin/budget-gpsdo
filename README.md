# budget-gpsdo
Provable 10MHz±0.01Hz (or better) into 50Ω at low cost 

The original intent of this project was to create a minimum cost GPSDO using a microprocessor to do as much of the work as possible. The design goal was 10MHz within 1 part per billion or better. Two other goals were to minimise user effort (no fiddly parameters to change) and have the GPSDO able to estimate if it was meeting the accuracy goal.

An initial design was created, and met the goals if the user was patient. The oscillator was easily perturbed when devices were attached, and required time to settle. The problem was thought to be unwanted variations in voltages applied to the OCXO. Apart from that failing, the design proved satisfactory. It consisted of a cheap used OCXO - the OSC5A2B02, a buffer 74HC04, and a controller PIC16F1455 supplied by a 5V wall wart.

To rectify the problem, a redesign isolated the OCXO from the influence of other components. The power supply was changed to a nominal 12V delivered to a buck converter delivering about 7V. This then supplies two regulators, one to supply the OCXO and one to supply the remaining components. The control voltage is buffered at the digital level with complementary MOSFETs (2N7000, BS250) so the analog control voltage is derived from the OCXO supply, not the PIC16 supply. To provide further isolation, the optional serial interface to the PIC16 is via optocouplers. This naturally increases the final cost, but this is justified by the improved stability.

To achieve the goal of minimal cost, there are several unusual features.

1 - the control voltage is generated by the PICs 10-bit PWM, the granularity is improved by dithering the pulses on a pulse by pulse basis. To interpolate between raw PWM values, selected pulses are extended by 25ns. The filtered output is equivalent to a 24 bit DAC.

2 - the PIC16 uses the OCXO output as its clock. That allows the PIC peripherals to time the arrival of 1 pulse per second from the GPS module to the nearest 25ns. There is no need for additional circuitry.

3 - the control voltage is changed at discrete intervals, a balance between the second to second variability of the GPS and the long term drift of the OCXO. This allows an estimate to be made of the accuracy of the 10MHz output.

This is a working project. Included here (when I get around to it) will be the circuit, PCB design, construction, commissioning and run documentation.

Although the design uses low cost components, it should translate to a high performance design by using a timer grade GPS module and a higher specification OCXO. The software is self calibrating so no changes would be needed.

Files:
Main.asm - the software written in PIC assembler. Read SettingUpMPLAB.pdf to create the .hex file.

SettingUpMPLAB.pdf - setting up MPLAB X V5.35 (the last version to support MPASM).

Software.pdf - an overview of how the software works.

GPSDO-2023-02-12_163841.zip - KiCad 6.0 files with schematic and PCB layout

Circuit.png - a printout of the schematic from KiCad 6.0 (to save you having to set it up)

GPSDOnotesV1.pdf - notes about commissioning and running the GPSDO

Notes: The schematic (and therefore the PCB) has a few optional bits.
1. There are spaces for filter capacitors around the buck converter. Some converters require them. Some have them onboard so not needed on the PCB.
2. There is provision for a precision regulator to supply 5V to the FET pair that generate the control voltage. It and associated components can be left out, a wire link can get the 5V from the OCXO regulator, with only a slight (hard to measure) degradation of performance.
3. There is provision to acquire the NMEA data and 1pps from a remotely located GPS module via a line driver/receiver pair. This has been tested to 20 metres, but most people will get satisfactory results plugging the GPS unit into the PCB. In the testing, a socket was installed for the line receiver (a UA9639). Pulling the IC allowed the GPS to be plugged in directly without removing other components.
4. Use of optocouplers is not strictly necessary but does ensure no earth loops with whatever is connected to the GPSDO.

Update:
2023-03-09 - Main.asm -  changed the code for calibration to fix some convergence issues (only occurred sometimes).
